<!DOCTYPE html PUBLIC "- //W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http: //www.w3.org/1999/xhtml" xml:lang="en">
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
  <title>Document</title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }

    /* body {
      height: 2000px;
    } */

    .text {
      width: 200px;
      height: 300px;
      margin: 100px auto;
      border: 1px solid #ccc;
      overflow: hidden;
      position: relative;
    }

    .text .content {
      background-color: pink;
      width: 180px;
      position: absolute;
      left: 0;
      top: 0;
    }

    .text .bar {
      background-color: greenyellow;
      position: absolute;
      width: 20px;
      height: 50px;
      right: 0;
      top: 0;
    }
  </style>
</head>
<body>
  <div class="text" id="text">
    <div class="bar" id="bar"></div>
    <div class="content" id="content">
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
      测试文本 测试文本 测试文本 测试文本
    </div>
  </div>

  <script src="../fetchStyle.js"></script>
  <script>
    var text = document.getElementById('text'),
        content = document.getElementById('content'),
        bar = document.getElementById('bar'),
        rate = text.clientHeight / content.clientHeight,
        barHeight = text.clientHeight * rate,
        curBarTop = 0,
        wheelStep = 20

    bar.style.height = barHeight + 'px'

    // 模拟拖拽过程
    bar.onmousedown = function(event) {
      event = event || window.event

      //核心-记录鼠标点击的屏幕上距离和滑块的偏移上距离之差
      var delta = event.clientY - bar.offsetTop
        
      document.onmousemove = function(event) {
        event = event || window.event

        // 清除原始的选取功能
        if (event.preventDefault) {
          event.preventDefault()
        } else {
          event.returnValue = false
        }
        curBarTop = event.clientY - delta
        
        if (curBarTop < 0) { //验收，限制滑块的运动范围
          curBarTop = 0
        } else if (curBarTop > text.clientHeight - bar.clientHeight) {
          curBarTop = text.clientHeight - bar.clientHeight
        }
        bar.style.top = curBarTop + 'px'
        content.style.top = - curBarTop / rate + 'px'
      }
    }

    document.onmouseup = function() {
      document.onmousemove = null
    }
  
    // 绑定鼠标滚轮事件实现
    content.onmousewheel = mousewheelHandler
    //鼠标滚轮for Firefox
    content.addEventListener('DOMMouseScroll', mousewheelHandler, false)

    function mousewheelHandler(event) {
      event = event || window.event
      // 清除原始的鼠标滚轮造成页面滚动的效果
      if (event.preventDefault) {
        event.preventDefault()
      } else {
        event.returnValue = false
      }

      
      var direction = 0
      if (event.wheelDelta) {
        direction = event.wheelDelta > 0 ? 1 : -1
      } else if (event.detail) {
        direction = event.detail > 0 ? -1 : 1
      }

      curBarTop += -wheelStep * direction
      if (curBarTop < 0) { //验收，限制滑块的运动范围
        curBarTop = 0
      } else if (curBarTop > text.clientHeight - bar.clientHeight) {
        curBarTop = text.clientHeight - bar.clientHeight
      }
      bar.style.top = curBarTop + 'px'
      content.style.top = - curBarTop / rate + 'px'
      
    }
  </script>
</body>